diff --git a/create.cc b/create.cc
index 11c4041..fcfcc41 100644
--- a/create.cc
+++ b/create.cc
@@ -27,6 +27,11 @@
     !defined __DragonFly__ && !defined __APPLE__ && !defined __OS2__
 #include <sys/sysmacros.h>		// for major, minor
 #endif
+#if !defined(HAVE_MAJOR) && !defined(major)
+/* Replacement for major/minor/makedev. */
+#define	major(x) ((int)(0x00ff & ((x) >> 8)))
+#define	minor(x) ((int)(0xffff00ff & (x)))
+#endif
 #include <ftw.h>
 #include <grp.h>
 #include <pwd.h>
diff --git a/decode.cc b/decode.cc
index 1742df2..31abc3f 100644
--- a/decode.cc
+++ b/decode.cc
@@ -30,6 +30,12 @@
     !defined __DragonFly__ && !defined __APPLE__ && !defined __OS2__
 #include <sys/sysmacros.h>		// for major, minor, makedev
 #endif
+#if !defined(HAVE_MAJOR) && !defined(major)
+/* Replacement for major/minor/makedev. */
+#define	major(x) ((int)(0x00ff & ((x) >> 8)))
+#define	minor(x) ((int)(0xffff00ff & (x)))
+#define	makedev(maj,min) ((0xff00 & ((maj)<<8)) | (0xffff00ff & (min)))
+#endif
 #include <lzlib.h>
 
 #include "tarlz.h"
diff --git a/decode_lz.cc b/decode_lz.cc
index 15ac2a7..4bfc627 100644
--- a/decode_lz.cc
+++ b/decode_lz.cc
@@ -30,6 +30,12 @@
     !defined __DragonFly__ && !defined __APPLE__ && !defined __OS2__
 #include <sys/sysmacros.h>		// for major, minor, makedev
 #endif
+#if !defined(HAVE_MAJOR) && !defined(major)
+/* Replacement for major/minor/makedev. */
+#define	major(x) ((int)(0x00ff & ((x) >> 8)))
+#define	minor(x) ((int)(0xffff00ff & (x)))
+#define	makedev(maj,min) ((0xff00 & ((maj)<<8)) | (0xffff00ff & (min)))
+#endif
 #include <lzlib.h>
 
 #include "tarlz.h"
